package com.ratego.model;

import lombok.Data;

/*******************************************************************************
 * [PageDTO]
 * 설명 : 화면 하단에 뿌려질 페이지 번호(Pagination)를 계산하는 클래스
 * 역할 : Criteria(현재 페이지)와 total(전체 글 수)을 받아서
 * StartPage, EndPage, Prev, Next 여부를 자동 계산함.
 * 프로젝트 : RateGo Project
 *******************************************************************************/
@Data
public class PageDTO {

    /* =================================================================
     * 1. 결과 데이터 (JSP/Thymeleaf 화면에서 사용할 값들)
     * ================================================================= */
    private int startPage;      // 화면에 보여질 시작 페이지 번호 (예: 1, 11, 21...)
    private int endPage;        // 화면에 보여질 끝 페이지 번호 (예: 10, 20, 30...)
    private boolean prev, next; // 이전(<), 다음(>) 버튼 활성화 여부

    /* =================================================================
     * 2. 입력 데이터 (계산의 기준값)
     * ================================================================= */
    private int total;          // DB에서 가져온 전체 게시글 수
    private Criteria cri;       // 현재 페이지 번호, 한 페이지당 개수 정보


    /*******************************************************************************
     * [CONSTRUCTOR] 페이징 계산 로직 (핵심)
     * - 객체가 생성될 때 모든 페이지 번호를 계산해버림
     *******************************************************************************/
    public PageDTO(Criteria cri, int total) {
        this.cri = cri;
        this.total = total;

        // ------------------------------------------------------
        // Step 1. 화면에 보여질 '끝 페이지' 번호 우선 계산 (가짜 끝 페이지)
        // ------------------------------------------------------
        // 공식 : 올림(현재페이지 / 10.0) * 10
        // 예시 : 현재 3페이지 -> 0.3 -> 올림 1 -> 1 * 10 = 10 (1~10구간)
        // 예시 : 현재 15페이지 -> 1.5 -> 올림 2 -> 2 * 10 = 20 (11~20구간)
        this.endPage = (int) (Math.ceil(cri.getPageNum() / 10.0)) * 10;
        
        // ------------------------------------------------------
        // Step 2. '시작 페이지' 계산
        // ------------------------------------------------------
        // 공식 : 끝페이지 - 9
        // 예시 : 10 - 9 = 1, 20 - 9 = 11
        this.startPage = this.endPage - 9;

        // ------------------------------------------------------
        // Step 3. '진짜 끝 페이지' 계산 (데이터 기준)
        // ------------------------------------------------------
        // 전체 글이 75개고, 한 페이지에 10개씩 보여준다면?
        // 75 / 10.0 = 7.5 -> 올림 8페이지가 진짜 끝.
        int realEnd = (int) (Math.ceil((total * 1.0) / cri.getAmount()));

        // ------------------------------------------------------
        // Step 4. 끝 페이지 보정
        // ------------------------------------------------------
        // Step 1에서 구한 endPage(10)가 realEnd(8)보다 크면?
        // 굳이 10페이지까지 보여줄 필요 없으니 8로 덮어씌움.
        if (realEnd < this.endPage) {
            this.endPage = realEnd;
        }

        // ------------------------------------------------------
        // Step 5. 이전(Prev) / 다음(Next) 버튼 활성화 여부
        // ------------------------------------------------------
        // Prev : 시작페이지가 1보다 크면 무조건 있음 (11, 21...)
        this.prev = this.startPage > 1;
        
        // Next : 현재 구역의 끝페이지(endPage)보다 진짜 끝(realEnd)이 더 남아있으면 있음
        this.next = this.endPage < realEnd;
    }
}